<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/vaadin-charts/vaadin-charts.html">

<!-- Element for displaying a sparkline chart and stuff around it. -->
<dom-module id="dash-sparklet">
    <!-- Import flex layout classes. -->

    <style>
      :host {
        padding: 12px;
        box-sizing: border-box;
        border: 1px solid #EAEAEA;
        background-color: white;

        display: flex;
        flex-flow: column nowrap;

        text-align: center;
      }

      .average {
        font-size: 26px;
      }

      .label {
        font-size: 14px;
      }

      .high, .low {
        display: inline-block;
      }

      .chart {
        height: 20px;
        padding: 15px 0;
      }

      /* TODO: Color of line should be set with a variable. */
    </style>
    <template>
      <div class="average">
        [[prefix]][[average]][[suffix]]
      </div>

      <div class="label">
        [[label]]
      </div>

      <div class="chart">
        <vaadin-sparkline data={{data}}></vaadin-sparkline>
      </div>


      <div class="bottom">
        <div class="high">
          High
          <b>[[high]]</b>
        </div>
        <div class="low">
          Low
          <b>[[low]]</b>
        </div>
      </div>
    </template>

    <script>
    Polymer({
        is: 'dash-sparklet',

        properties: {
          data: {
            type: Array,
            value: () => []
          },

          prefix: String,
          suffix: String,
          label: {
            String,
            value: '\xA0' // Inserts nonbreaking space when label is empty.
          },

          average: {
            type: Number,
            computed: '_average(data)'
          },

          high: {
            type: Number,
            computed: '_high(data)'
          },

          low: {
            type: Number,
            computed: '_low(data)'
          }
        },

        _average: function(data) {
          // return 0 as a fallback
          return Math.floor(data.reduce((a, b) => a + b, 0) / data.length || 0);
        },


        _high: (data) => data.length ? Math.max(...data) : '--',
        _low: (data) => data.length ? Math.min(...data): '--'
    });
    </script>
</dom-module>
